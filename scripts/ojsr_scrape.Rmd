---
title: "OJSR Scrape"
author: "Saurabh Khanna"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
---

```{r setup, include=FALSE}
# knitr options
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.retina = 4)
```


```{r message=FALSE, warning=FALSE}
# Libraries
pacman::p_load(tidyverse, ojsr, oai)

# Data
df <- read_csv(here::here("data", "beacon.csv"))
# correcting some oai urls
df <- df %>% mutate(oai_url = if_else(str_detect(oai_url, "^//"), str_c("http:", oai_url), oai_url))
```

```{r}
journals <- 
  data.frame(cbind(
    oai_url = c(
      "https://dspace.palermo.edu/ojs/index.php/psicodebate/issue/archive",
      "https://publicaciones.sociales.uba.ar/index.php/odisea"
    )
  ), stringsAsFactors = FALSE
  )
```


```{r}
bind_cols(
  journals %>% head(),
  journals %>% head() %>% pull(oai_url) %>% parse_base_url(),
  journals %>% head() %>% pull(oai_url) %>% get_issues_from_archive() %>% view()
)
```


```{r}
journals %>% 
  pull(oai_url) %>% 
  get_issues_from_archive() %>% 
  pull(output_url) %>% 
  get_articles_from_issue() %>% 
  head(1) %>% 
  pull(output_url) %>% 
  get_html_meta_from_article() %>%
  select(input_url, meta_data_name, meta_data_content) %>% 
  pivot_wider(names_from = meta_data_name, values_from = meta_data_content) %>% 
  mutate_all(as.character)
```


```{r}
df %>% 
  filter(str_detect(oai_url, "revues.imist")) %>% 
  pull(oai_url) %>% 
  parse_base_url() %>% 
  head(1) %>% 
  get_issues_from_archive()
```


