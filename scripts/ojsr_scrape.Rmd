---
title: "OAI Scrape"
author: "Saurabh Khanna"
date: "`r Sys.Date()`"
output: 
  github_document:
    toc: true
---

```{r setup, include=FALSE}
# knitr options
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.retina = 4)
```


```{r message=FALSE, warning=FALSE}
# Libraries
pacman::p_load(tidyverse, ojsr, oai, janitor, lubridate, urltools)

# Data
df <- read_csv(here::here("data", "beacon.csv"))

# correcting some oai urls
df %>% 
  mutate(oai_url = if_else(str_detect(oai_url, "^//"), str_c("http:", oai_url), oai_url)) %>% 
  filter(country == "Morocco") %>%
  summarize(tot = sum(total_record_count, na.rm = T)) %>% 
  
```

```{r}
x <- list_identifiers("https://revues.imist.ma/index.php/index/oai")
```

```{r}
x
```

```{r}
y <- list_records("https://revues.imist.ma/index.php/index/oai")
```


```{r}
y %>% 
  select(contains("pub")) %>% 
  mutate(year = str_sub(date, 1, 4)) %>% 
  summarize_all(~ mean(is.na(.)))
```


